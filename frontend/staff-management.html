<!DOCTYPE html>
<html>
<head>
  <title>Staff Management</title>
  <link rel="stylesheet" href="staff-management.css">
</head>
<body>

<header>
  <h1>üè® Hostel Staff Management</h1>
</header>

<main>

  <!-- Add User Form -->
  <section class="form-section">
    <h2>Add New Staff</h2>

    <div class="form-grid">
      <input type="text" id="username" placeholder="Username">
      <input type="email" id="email" placeholder="Email">
      <input type="text" id="contact" placeholder="Contact No">

      <select id="role">
        <option value="">Select Role</option>
        <option value="ADMIN">Admin</option>
        <option value="WARDEN">Warden</option>
        <option value="COOK">Cook</option>
        <option value="SECURITY">Security</option>
        <option value="CLEANER">Cleaner</option>
      </select>

      <button onclick="addUser()">‚ûï Add User</button>
    </div>

    <div id="message" class="info-msg"></div>
  </section>

  <!-- Staff Table -->
  <section class="table-section">
    <h2>Staff List</h2>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Role</th>
          <th>Email</th>
          <th>Contact</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="staffTable"></tbody>
    </table>
  </section>

</main>

<script>
const API = "http://localhost:3000/api/staff";

/* Load staff on page load */
window.onload = loadStaff;

/* Fetch Staff */
async function loadStaff() {
  try {
    const res = await fetch(API);
    const data = await res.json();

    const table = document.getElementById("staffTable");
    table.innerHTML = "";

    data.forEach(user => {
      const row = `
        <tr>
          <td>${user.user_id}</td>
          <td>${user.username}</td>
          <td>${user.role}</td>
          <td>${user.email || "-"}</td>
          <td>${user.contact_no || "-"}</td>
          <td>
            <button class="danger" onclick="deleteUser(${user.user_id}, '${user.username}')">
              üóë Delete
            </button>
          </td>
        </tr>
      `;
      table.innerHTML += row;
    });
  } catch (err) {
    console.error("Load Error", err);
  }
}

/* Add User */
async function addUser() {
  const username = document.getElementById("username").value.trim();
  const email = document.getElementById("email").value.trim();
  const contact_no = document.getElementById("contact").value.trim();
  const role = document.getElementById("role").value;

  if (!username || !email || !contact_no || !role) {
    alert("Please fill all fields");
    return;
  }

  try {
    const res = await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, email, contact_no, role })
    });

    const data = await res.json();
    document.getElementById("message").innerText = data.message;

    clearForm();
    loadStaff();
  } catch (err) {
    alert("Failed to add user");
  }
}

/* Delete User */
async function deleteUser(id, username) {
  const confirmDelete = confirm(`Are you sure you want to delete "${username}"?`);

  if (!confirmDelete) return;

  try {
    await fetch(`${API}/${id}`, { method: "DELETE" });
    loadStaff();
  } catch (err) {
    alert("Failed to delete user");
  }
}

/* Clear form */
function clearForm() {
  document.getElementById("username").value = "";
  document.getElementById("email").value = "";
  document.getElementById("contact").value = "";
  document.getElementById("role").value = "";
}
</script>

</body>
</html>
