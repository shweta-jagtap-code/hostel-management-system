<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Staff Management</title>
  <link rel="stylesheet" href="staff-management.css">
</head>
<body>

<header>
  <h1>Staff Management</h1>
</header>

<main>

  <!-- Add Staff -->
  <section class="form-section">
    <h2>Create User</h2>

    <p id="firstUserMsg" class="info-msg"></p>

    <form id="staffForm">
      <input type="text" id="username" placeholder="Username" required />
      <input type="email" id="email" placeholder="Email" required />
      <input type="text" id="contact_no" placeholder="Contact Number" />

      <!-- Role dropdown hidden initially -->
      <select id="role" style="display:none;">
        <option value="">Select Role</option>
        <option>ADMIN</option>
        <option>WARDEN</option>
        <option>COOK</option>
        <option>SECURITY</option>
        <option>CLEANER</option>
      </select>

      <button type="submit">Create User</button>
    </form>
  </section>

  <!-- Staff List -->
  <section class="table-section">
    <h2>Users</h2>
    <table id="staffTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Role</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

</main>

<script>
const API = "http://localhost:3000/api/users";
const staffTable = document.querySelector("#staffTable tbody");
const roleSelect = document.getElementById("role");
const infoMsg = document.getElementById("firstUserMsg");

async function loadUsers() {
  const res = await fetch(API);
  const users = await res.json();

  staffTable.innerHTML = "";

  users.forEach(u => {
    staffTable.innerHTML += `
      <tr>
        <td>${u.user_id}</td>
        <td>${u.username}</td>
        <td>${u.role}</td>
        <td>
          <button onclick="deleteUser(${u.user_id})">Delete</button>
        </td>
      </tr>
    `;
  });

  // If no users exist â†’ hide role
  if (users.length === 0) {
    roleSelect.style.display = "none";
    infoMsg.innerText = "ðŸ‘‘ First user will automatically become ADMIN";
  } else {
    roleSelect.style.display = "block";
    infoMsg.innerText = "";
  }
}

// Create user
document.getElementById("staffForm").addEventListener("submit", async e => {
  e.preventDefault();

  const payload = {
    username: username.value,
    email: email.value,
    contact_no: contact_no.value,
    role: roleSelect.value
  };

  const res = await fetch(API, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  const result = await res.json();
  alert(result.message);

  e.target.reset();
  loadUsers();
});

// Delete user
async function deleteUser(id) {
  if (!confirm("Delete this user?")) return;

  const res = await fetch(`${API}/${id}`, { method: "DELETE" });
  const result = await res.json();
  alert(result.message);
  loadUsers();
}

loadUsers();
</script>

</body>
</html>
